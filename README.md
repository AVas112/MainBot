Telegram Bot на Python c интеграцией в ChatGPT
Этот проект представляет собой телеграм-бота для автоматизированной обработки диалогов с пользователями. Бот сохраняет сообщения в базу данных, отправляет их к ChatGPT, формирует ответы и отправляет их обратно пользователю. Также он умеет запрашивать и сохранять контактные данные клиентов и по расписанию формировать и отправлять отчёты с историей диалогов на email.
Основные возможности
1.	Приём сообщений от пользователей
-	Пользователь общается с ботом в Telegram.
-	Каждый запрос и ответ сохраняются в базе данных (SQLite).
2.	Интеграция с ChatGPT
-	Бот передаёт сообщения пользователя в OpenAI, используя класс ChatGPTAssistant.
-	ChatGPT генерирует ответ, который возвращается пользователю.
-	Также поддерживается логика вызовов инструментов (tool calls), например, для запроса контактной информации.
3.	Сохранение контактных данных
-	Если ассистенту требуется запросить у пользователя контакты (имя, телефон и т.д.), бот обрабатывает это и может отправить уведомление по email.
-	Контактная информация вместе с сообщениями диалога сохраняется в таблице successful_dialogs.
4.	Ежедневные отчёты
-	Класс DailyReport формирует ежедневный HTML-отчёт о всех диалогах за последние 24 часа.
-	Отправляет отчёты на email по расписанию, используя APScheduler.
5.	Telegram-бот
-	Работает на библиотеке python-telegram-bot.
-	Обрабатывает команды /start, /help и текстовые сообщения.
-	Поддерживает ведение беседы в отдельном потоке ChatGPT для каждого пользователя (threads).
6.	Отправка email
-	Для рассылки писем бот использует SMTP-сервер.
-	При получении контактов клиента формируется письмо с HTML-шаблоном о заказе и всей историей переписки.
Структура проекта
bash
Копировать код
├── main.py                     # Точка входа: запуск бота
├── bot
│   ├── chatgpt_assistant.py    # Класс ChatGPTAssistant для интеграции с ChatGPT
│   ├── daily_report.py         # Класс DailyReport для генерации и отправки отчётов
│   ├── database.py             # Класс Database для работы с SQLite
│   ├── telegram_bot.py         # Класс TelegramBot - управление телеграм-ботом
│   └── ...
├── config
│   └── logging_config.py       # Настройка логирования
├── threads.json                # Хранение связей user_id -> thread_id
├── requirements.txt            # Зависимости проекта
└── README.md                   # Описание проекта (файл, который вы сейчас читаете)
Ключевые файлы и их предназначение
1.	main.py
-	Загружает переменные окружения (dotenv).
-	Настраивает логирование.
-	Создаёт экземпляр TelegramBot и запускает его.
2.	bot\telegram_bot.py
-	Основная логика телеграм-бота.
-	Регистрирует команды /start, /help и обработчик сообщений.
-	Сохраняет диалоги в БД, передаёт их в ChatGPTAssistant, получает ответ и отправляет пользователю.
-	Отправляет email при необходимости.
3.	bot\chatgpt_assistant.py
-	Класс ChatGPTAssistant инкапсулирует логику обращения к ChatGPT.
-	Создаёт и поддерживает потоки (threads) в OpenAI, обрабатывает ответы, вызывает дополнительные инструменты (tool calls).
4.	bot\daily_report.py
-	Класс DailyReport генерирует и отправляет ежедневные отчёты о диалогах.
-	Использует APScheduler для планирования отправки писем.
5.	bot\database.py
-	Класс Database для работы с SQLite.
-	Методы для сохранения сообщений, чтения полного диалога, сохранения успешных диалогов, а также для универсальных SQL-запросов.
6.	threads.json
-	Хранит связь между user_id и потоком ChatGPT (thread_id), чтобы поддерживать контекст.

